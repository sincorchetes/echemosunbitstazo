
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://sincorchetes.github.io/echemosunbitstazo/como-crear-tu-propio-repo-en-centos/item/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.1, mkdocs-material-7.1.8">
    
    
      
        <title>Como crear tu propio repositorio en CentOS - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#como-crear-tu-propio-repositorio-en-centos" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Como crear tu propio repositorio en CentOS
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../01.curso-de-python-imprimir-valores-y-funciones/item/" class="md-tabs__link">
      Introduction
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../about.md" class="md-tabs__link">
      None
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="https://example.com/" class="md-tabs__link">
      Issue Tracker
    </a>
  </li>

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../01.curso-de-python-imprimir-valores-y-funciones/item/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about.md" class="md-nav__link">
        None
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://example.com/" class="md-nav__link">
        Issue Tracker
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#informacion-de-la-subred" class="md-nav__link">
    Información de la subred
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#direccion-de-subred-equipos" class="md-nav__link">
    Dirección de subred equipos
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="como-crear-tu-propio-repositorio-en-centos">Como crear tu propio repositorio en CentOS</h1>
<p>YUM o <em>Yellowdog Updater Modified</em> es un gestor de paquetes de alto nivel utilizado por Fedora previo sa la salida de su nuevo gestor de paquetes DNF (basado en YUM), y el que utiliza CentOS y RHEL.</p>
<p>En este post vamos a ver como crear un repositorio local con CentOS para mantener nuestros paquetes personalizados actualizados, o bien para hacer de "<em>catcher</em>" dentro de una red y que puedan distribuirse las actualizaciones oficiales al resto de equipos sin tener que consumir el ancho de banda proporcionado por el ISP que tengamos contratado.</p>
<p>Tenemos que tener un equipo con al menos dos tarjetas de red, una con salida al exterior y otra en la que conecta a la topología interna de nuestro hogar, empresa...etc</p>
<p>Vamos ha hacer el ejemplo con una subred de clase C y con una topología en serie (<em>el cliente se conecta a un servidor directamente conectado, y el servidor está conectado directamente al ISP</em>).</p>
<h2 id="informacion-de-la-subred">Información de la subred</h2>
<ul>
<li>Subred: 192.168.0.64/26 </li>
<li>Máscara: 255.255.255.128 </li>
<li>Broadcast: 192.168.0.127</li>
</ul>
<h2 id="direccion-de-subred-equipos">Dirección de subred equipos</h2>
<p>Servidor:
 * IP: 192.168.0.64
 * Nombre de la NIC: enp0s8
Cliente:
 * Conexión mediante DHCP
 * Nombre NIC: enp0s3</p>
<p>A continuación vamos a instalar todo lo necesario en el servidor.</p>
<h1 id="configurando-el-servidor">Configurando el Servidor</h1>
<p>Pasos a seguir:
 * Configurando interfaz de red interna
 * Instalando y configurando Kea
 * Instalando y configurando Apache
 * Gestionando Firewalld
 * Instalando createrepo</p>
<h2 id="configurando-interfaz-de-red-interna">Configurando interfaz de red interna</h2>
<p>En distribuciones como CentOS/RHEL y Fedora, almacenan sus configuraciones de red en el directorio <code>/etc/sysconfig/network-scripts/</code>.</p>
<p>Modificamos el archivo de la interfaz que utilizaremos a nivel interno:
`</p>
<pre><code>BOOTPROTO=static
NAME=enp0s8
DEVICE=enp0s8
ONBOOT=yes
ZONE=discrete
IPADDR=192.168.0.65
NETMASK=255.255.255.128
</code></pre>
<p>Levantando la red:</p>
<pre><code>sudo ifdown enp0s8
sudo ifup enp0s8
</code></pre>
<h2 id="instalando-y-configurando-kea">Instalando y configurando Kea</h2>
<p>Kea es un servidor DHCP desarrollado por la <em>Internet Systems Consortium, Inc</em>, permite una implementación completa de servidores DHCPv4 (IPv4), DHCPv6 (IPv6) y DNS dinámicos.</p>
<pre><code>sudo yum install kea
</code></pre>
<h3 id="modificando-etckeakeaconf">Modificando <code>/etc/kea/kea.conf</code></h3>
<p>Modificamos el fichero troncal de Kea tal que así:</p>
<pre><code># DHCPv4 configuration start here
&quot;Dhcp4&quot;:
{
# Add names of interfaces to listen on.
    &quot;interfaces-config&quot;: {
     &quot;interfaces&quot;: [ &quot;enp0s8&quot; ]
    },
</code></pre>
<p>Y modificamos el apartado de subred para IPv4, tal que así:</p>
<pre><code>    &quot;subnet4&quot;: [
    {
        &quot;subnet&quot;: &quot;192.168.0.64/26&quot;,
        &quot;pools&quot;: [ { &quot;pool&quot;: 192.168.0.70 - 192.168.0.126&quot; } ] }
        ]
    },
</code></pre>
<p>Como vemos, hemos dejado 4 IPs para <em>hosts</em> excluidas dentro de este rango, simplemente por si queremos añadir dispositivos estáticos aparte de nuestro servidor.</p>
<p>Iniciamos el servicio:</p>
<pre><code>sudo systemctl start kea-dhcpv4.service
</code></pre>
<p>Añadimos el servicio para que arranque cuando inicie el sistema:</p>
<pre><code>sudo systemctl enable kea-dhcpv4.service
</code></pre>
<h2 id="instalando-y-configurando-apache">Instalando y configurando Apache</h2>
<p>Personalmente, trabajo con Apache, pero podéis utilizar NGINX si queréis.</p>
<pre><code>sudo yum install httpd
</code></pre>
<p>Iniciamos</p>
<pre><code>sudo systemctl start httpd.service
</code></pre>
<h2 id="gestionando-firewalld">Gestionando Firewalld</h2>
<p>Firewalld es un gestor dinámico del firewall de Linux que viene por defecto en distribuciones como Fedora, RHEL, CentOS.
Podemos definir zonas con servicios y puertos específicos, y asociar dichas zonas a determinadas interfaces de red entre otras cosas.</p>
<p>Creamos una zona personalizada:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;zone&gt;
  &lt;short&gt;Discrete&lt;/short&gt;
  &lt;description&gt;Internal use only.&lt;/description&gt;
  &lt;interface name=&quot;enp0s8&quot;/&gt;
  &lt;service name=&quot;http&quot;/&gt;
&lt;/zone&gt;
</code></pre>
<p>Reiniciamos el servicio</p>
<pre><code>sudo systemctl restart firewalld.service
</code></pre>
<p>Comprobando que trabaja:</p>
<pre><code>sudo firewall-cmd --get-active-zones
</code></pre>
<p>Deberá salir una salida tal que así:</p>
<pre><code>public
    interfaces: enp0s3
discrete
    interfaces: enp0s8
</code></pre>
<p>Esto nos permite las conexiones del protocolo HTTP a nuestro servidor, cualquier cliente que se encuentre en la red asociado a la tarjeta <code>enp0s8</code>.</p>
<p><em><strong>NOTA Importante: Si utilizas otro puerto para asistir a las peticiones del servidor Web, tendremos que sustituir la linea <code>&lt;service name="http"/&gt;</code> por <code>&lt;port protocol="tcp" port "xx"/&gt;</code>, además, si utilizamos SELinux, tendremos que añadir la apertura del puerto. <code>sudo semanage port -a -t http_port_t -p tcp xx</code></strong></em></p>
<h2 id="instalando-createrepo">Instalando createrepo</h2>
<p>Este programa permite generar todo lo necesario para tener un repositorio, como el <code>repomd.xml</code> un fichero basado en XML que contiene metadatos registrando todo lo que tiene un repositorio.
Creamos el directorio dentro de la ruta del <code>ServerRoot</code> configurado en nuestro Apache: <code>/var/www/html</code></p>
<pre><code>sudo mkdir -p /var/www/html/local/packages
</code></pre>
<p>Creamos el repo</p>
<pre><code>sudo createrepo --database /var/www/html/local
</code></pre>
<p>Y se creará una carpeta llamada <code>repodata</code>, creamos un enlace simbólico de <code>repomd.xml</code>:</p>
<pre><code>sudo ln -s /var/www/html/local/repodata/repomd.xml /var/www/html/local/
</code></pre>
<p>Probamos si podemos descargar este fichero:</p>
<pre><code>wget http://localhost/local/repomd.xml
</code></pre>
<p>ó visualizarlo con curl</p>
<pre><code>curl http://localhost/local/repomd.xml
</code></pre>
<p>Copiamos o añadimos todos los paquetes tengamos en nuestro nuevo repositorio y listo.
Si queremos actualizar los metadatos y la base de datos dónde se almacena la información de los paquetes, solo bastará con ejecutar:</p>
<pre><code>sudo createrepo --update /var/www/html/local
</code></pre>
<p><em><strong>NOTA: Si utilizamos SELinux, un conjunto de políticas que trabajan conjuntamente con el kernel para proporcionar seguridad al sistema, tendremos que reestablecer las etiquetas con <code>restorecon</code>, este comando se encuentra en el paquete <code>policycoreutils</code>, viene por defecto instalado en el sistema.</strong></em></p>
<pre><code>sudo restorecon -vR /var/ww/html/local/*
</code></pre>
<h2 id="b-o-n-u-s">B-O-N-U-S</h2>
<p>Si queremos hacer de "<em>catcher</em>", podemos copiar todos los paquetes que se encuentren almacenados cuando hemos hecho instalaciones y centrarlas en nuestro repo.</p>
<p>Por ejemplo:</p>
<pre><code>Descargamos de los repositorios base, updates, epel paquetes --&gt; Copiamos en la carpeta de nuestro repo --&gt; Eliminamos los repositorios de los clientes y dejamos solo el nuestro.
</code></pre>
<p>Con este pequeño script que puedes descargar desde aquí podemos hacerlo.</p>
<p>Descargamos el script:</p>
<pre><code>git clone https://github.com/sincorchetes/ownyumrepo
</code></pre>
<p>Ejecutamos</p>
<pre><code>chmod +x ownyumrepo
./ownyumrepo
</code></pre>
<p><em>NOTA: Si tu repo tiene otro nombre y directorio, tendrás que modificarlo</em></p>
<h1 id="configuando-el-cliente">Configuando el cliente</h1>
<p>Pasos a seguir:
 * Configurando la interfaz de red
 * Creando <code>local.repo</code></p>
<h2 id="configurando-la-interfaz-de-red">Configurando la interfaz de red</h2>
<p>Si utilizáis CLI en vez de interfaz gráfica, editamos el interfaz <code>/etc/sysconfig/network-scripts/ifcfg-enp0s3</code></p>
<pre><code>BOOTPROTO=dhcp
NAME=enp0s3
DEVICE=enp0s3
ONBOOT=yes
</code></pre>
<p>Levantando la red:</p>
<pre><code>sudo ifup enp0s3
</code></pre>
<h2 id="creando-localrepo">Creando <code>local.repo</code></h2>
<p>Creamos el fichero de nuestro repositorio local tal que así:</p>
<pre><code>[local]
name=Local
baseurl=http://192.168.0.65/local/
enabled=1
</code></pre>
<p>Actualizamos</p>
<pre><code>sudo yum check-update
</code></pre>
<p>Y listo, ya podemos instalar, si quieres ver qué paquetes tenemos disponibles para instalar:</p>
<pre><code>yum list available |grep local
</code></pre>
<p><em>NOTA: Si hemos hecho el paso B-O-N-U-S, tendremos que desactivar todos los repositorios de yum menos el nuestro. Basta con mover todos a una carpeta nueva llamada backup-repos y listo</em></p>
<p>¡Espero que les haya gustado este tutorial!</p>
<h1 id="referencias">Referencias</h1>
<ul>
<li><a href="https://access.redhat.com/solutions/9892?target=_blank">RHEL Documentation database</a></li>
<li><a href="https://firewalld.org/documentation?target=_blank">Firewalld documentation</a> </li>
<li>Kea, ifcfg, restorecon... man database</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.b0710199.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.76f349be.min.js"></script>
      
    
  </body>
</html>